"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9701],{14571:(O,c,t)=>{t.d(c,{o:()=>d});var a=t(52322),s=t(2784);class d extends s.Component{state={hadError:!1};componentDidCatch(p){this.setState({hadError:!0}),this.props.onError(p)}render(){return this.state.hadError?(0,a.jsx)(a.Fragment,{}):this.props.children}}},59701:(O,c,t)=>{t.r(c),t.d(c,{default:()=>X});var a=t(52322),s=t(2784),d=t(28316),m=t(75845),p=t(14571),R=t(75017),A=t(14123),P=t(1309),v=t(68434),x=t(68234),M=t(20379),B=t(38677),D=t(72970),$=t(23503),u=t(93812),z=t(88724),W=t(77075),H=t(67067),I=t(25513);const N={requestPayload:"{}",layout:"vertical"};function J(e){if(!e)return"Service cannot be empty"}function L(e,r){return(0,H.Uy)(e,o=>{if(r.action==="update"){const{path:l,value:C}=r.payload;I.Z(o,l.slice(1),C)}})}function G(e){const r=(0,s.useMemo)(()=>({general:{fields:{serviceName:{label:"Service name",input:"string",error:J(e.serviceName),value:e.serviceName??""},layout:{label:"Layout",input:"toggle",options:[{label:"Vertical",value:"vertical"},{label:"Horizontal",value:"horizontal"}],value:e.layout??N.layout}}},button:{label:"Button",fields:{buttonText:{label:"Title",input:"string",value:e.buttonText,placeholder:`Call service ${e.serviceName??""}`},buttonTooltip:{label:"Tooltip",input:"string",value:e.buttonTooltip},buttonColor:{label:"Color",input:"rgb",value:e.buttonColor}}}}),[e]);return(0,m.O4)(r)}var F="../../packages/studio-base/src/panels/CallService";const U=$.ZP.getLogger(F),K=(0,D.ZL)()((e,{buttonColor:r})=>{const o=r?e.palette.augmentColor({color:{main:r}}):void 0;return{button:{backgroundColor:o?.main,color:o?.contrastText,"&:hover":{backgroundColor:o?.dark}},textarea:{height:"100%",[`.${P.Z.root}`]:{width:"100%",height:"100%",textAlign:"left",overflow:"hidden",padding:e.spacing(1,.5),[`.${P.Z.input}`]:{height:"100% !important",lineHeight:1.4,fontFamily:W.R.MONOSPACE,overflow:"auto !important",resize:"none"}}}}});function V(e){let r,o;try{const l=JSON.parse(e);Array.isArray(l)?o="Request content must be an object, not an array":l==null?o="Request content must be an object, not null":typeof l!="object"?o=`Request content must be an object, not \u2018${typeof l}\u2019`:r=l}catch(l){o=e.length!==0?l.message:"Enter valid request content as JSON"}return{error:o,parsedObject:r}}function Y({context:e}){const[r,o]=(0,s.useState)(()=>()=>{}),[l,C]=(0,s.useState)(),[S,f]=(0,s.useState)(),[n,y]=(0,s.useState)(()=>({...N,...e.initialState})),{classes:j}=K({buttonColor:n.buttonColor});(0,s.useEffect)(()=>{e.saveState(n),e.setDefaultPanelTitle(n.serviceName?`Call service ${n.serviceName}`:void 0)},[n,e]),(0,s.useEffect)(()=>(e.watch("colorScheme"),e.onRender=(i,E)=>{o(()=>E),C(i.colorScheme)},()=>{e.onRender=void 0}),[e]);const{error:h,parsedObject:q}=(0,s.useMemo)(()=>V(n.requestPayload??""),[n.requestPayload]),b=(0,s.useCallback)(i=>{y(E=>L(E,i))},[y]),T=G(n);(0,s.useEffect)(()=>{e.updatePanelSettingsEditor({actionHandler:b,nodes:T})},[e,b,T]);const Z=(0,s.useMemo)(()=>{if(e.callService==null)return"Connect to a data source that supports calling services";if(!n.serviceName)return"Configure a service in the panel settings"},[e,n.serviceName]),k=Boolean(e.callService!=null&&n.requestPayload&&n.serviceName&&q!=null&&S?.status!=="requesting"),w=(0,s.useCallback)(async()=>{if(!e.callService){f({status:"error",value:"The data source does not allow calling services"});return}try{f({status:"requesting",value:`Calling ${n.serviceName}...`});const i=await e.callService(n.serviceName,JSON.parse(n.requestPayload));f({status:"success",value:JSON.stringify(i,void 0,2)??""})}catch(i){f({status:"error",value:i.message}),U.error(i)}},[e,n.serviceName,n.requestPayload]);return(0,s.useEffect)(()=>{r()},[r]),(0,a.jsx)(z.Z,{isDark:l==="dark",children:(0,a.jsxs)(u.Z,{flex:"auto",gap:1,padding:1.5,position:"relative",fullHeight:!0,children:[(0,a.jsxs)(u.Z,{gap:1,flexGrow:"1",direction:n.layout==="horizontal"?"row":"column",children:[(0,a.jsxs)(u.Z,{flexGrow:"1",children:[(0,a.jsx)(v.Z,{variant:"caption",noWrap:!0,children:"Request"}),(0,a.jsx)(x.Z,{variant:"outlined",className:j.textarea,multiline:!0,size:"small",placeholder:"Enter service request as JSON",value:n.requestPayload,onChange:i=>{y({...n,requestPayload:i.target.value})},error:h!=null}),h&&(0,a.jsx)(v.Z,{variant:"caption",noWrap:!0,color:h?"error":void 0,children:h})]}),(0,a.jsxs)(u.Z,{flexGrow:"1",children:[(0,a.jsx)(v.Z,{variant:"caption",noWrap:!0,children:"Response"}),(0,a.jsx)(x.Z,{variant:"outlined",className:j.textarea,multiline:!0,size:"small",placeholder:"Response",value:S?.value,error:S?.status==="error"})]})]}),(0,a.jsxs)(u.Z,{direction:"row",justifyContent:"flex-end",alignItems:"center",overflow:"hidden",flexGrow:0,gap:1.5,children:[Z&&(0,a.jsx)(v.Z,{variant:"caption",noWrap:!0,children:Z}),(0,a.jsx)(M.Z,{title:n.buttonTooltip,children:(0,a.jsx)("span",{children:(0,a.jsx)(B.Z,{className:j.button,variant:"contained",disabled:!k,onClick:w,"data-testid":"call-service-button",children:n.buttonText?n.buttonText:`Call service ${n.serviceName??""}`})})})]})]})})}function Q(e,r){return d.render((0,a.jsx)(s.StrictMode,{children:(0,a.jsx)(p.o,{onError:e,children:(0,a.jsx)(Y,{context:r})})}),r.panelElement),()=>{d.unmountComponentAtNode(r.panelElement)}}function g(e){const r=(0,m.iY)(),o=(0,s.useMemo)(()=>Q.bind(void 0,r),[r]);return(0,a.jsx)(A._,{config:e.config,saveConfig:e.saveConfig,initPanel:o,highestSupportedConfigVersion:1})}g.panelType="CallService",g.defaultConfig={};const X=(0,R.Z)(g)}}]);

//# sourceMappingURL=9701.f7efd4a2c83336a75042.js.map