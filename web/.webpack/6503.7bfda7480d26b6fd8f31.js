"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6503],{14571:(H,I,r)=>{r.d(I,{o:()=>x});var C=r(52322),i=r(2784);class x extends i.Component{state={hadError:!1};componentDidCatch(A){this.setState({hadError:!0}),this.props.onError(A)}render(){return this.state.hadError?(0,C.jsx)(C.Fragment,{}):this.props.children}}},6503:(H,I,r)=>{r.r(I),r.d(I,{default:()=>ze});var C=r(52322),i=r(2784),x=r(75845),P=r(75017),A=r(14123),h=r(85062),Z=r.n(h),J=r(41501),k=r(61232),$=r(2071),j=r(28316),y=r(14571),M=r(67067),Q=r(57525),ye=r(58702),Te=r(84585),Ae=r(65741),re=r(67154),Se=r(99004),Me=r(5817),Oe=r.n(Me),Le=r(62515),Ne=r(94225),ae=r(8220),_=r(44668),q=r(93812),$e=r(30726),ie=r(4471),W=r(32975),F;(function(e){e[e.COVARIANCE_TYPE_UNKNOWN=0]="COVARIANCE_TYPE_UNKNOWN",e[e.COVARIANCE_TYPE_APPROXIMATED=1]="COVARIANCE_TYPE_APPROXIMATED",e[e.COVARIANCE_TYPE_DIAGONAL_KNOWN=2]="COVARIANCE_TYPE_DIAGONAL_KNOWN",e[e.COVARIANCE_TYPE_KNOWN=3]="COVARIANCE_TYPE_KNOWN"})(F||(F={}));var G;(function(e){e[e.STATUS_NO_FIX=-1]="STATUS_NO_FIX",e[e.STATUS_FIX=0]="STATUS_FIX",e[e.STATUS_SBAS_FIX=1]="STATUS_SBAS_FIX",e[e.STATUS_GBAS_FIX=2]="STATUS_GBAS_FIX"})(G||(G={}));var le;(function(e){e[e.SERVICE_GPS=1]="SERVICE_GPS",e[e.SERVICE_GLONASS=2]="SERVICE_GLONASS",e[e.SERVICE_COMPASS=4]="SERVICE_COMPASS",e[e.SERVICE_GALILEO=8]="SERVICE_GALILEO"})(le||(le={}));function Ie(e){const s=e.position_covariance;if(s)switch(e.position_covariance_type){case void 0:return;case F.COVARIANCE_TYPE_UNKNOWN:return;case F.COVARIANCE_TYPE_DIAGONAL_KNOWN:{const v=s[0],n=s[4];return!isFinite(v)||!isFinite(n)?void 0:{radii:[Math.sqrt(v),Math.sqrt(n)],tilt:0}}case F.COVARIANCE_TYPE_APPROXIMATED:case F.COVARIANCE_TYPE_KNOWN:{const v=s,n=[[v[0],v[1]],[v[3],v[4]]];try{const p=(0,ie.Gq_)(n),f=[p.vectors[0][1],p.vectors[1][1]],T=p.values;if(!(0,W.hj)(f[0])||!(0,W.hj)(f[1])||!(0,W.hj)(T[0])||!(0,W.hj)(T[1]))return;const m=-1*((0,ie.fvJ)(f[1],f[0])*180/Math.PI),g=Math.sqrt(T[1]),S=Math.sqrt(T[0]);return!isFinite(m)||!isFinite(g)||!isFinite(S)?void 0:{radii:[g,S],tilt:m}}catch{return}}}}const ce=3;class xe extends h.CircleMarker{messageEvent}function be(e){const{navSatMessageEvents:s,bounds:v,map:n}=e,p={stroke:!1,color:e.color,fillOpacity:1},f=new h.FeatureGroup,T=v,d=[];for(const m of s){const g=m.message.latitude,S=m.message.longitude;if(!T.contains([g,S]))continue;const Y=n.latLngToContainerPoint([g,S]),U=Math.trunc(Y.x),L=Math.trunc(Y.y);if(d[U]?.[L]===!0)continue;(d[U]=d[U]??[])[L]=!0;const B=new xe([g,S],{...p,radius:ce});if(B.messageEvent=m,B.addTo(f),e.showAccuracy===!0){const b=Ie(m.message);b!=null&&new h.Ellipse([g,S],b.radii,b.tilt,{color:e.color,fillOpacity:.2,stroke:!1}).addTo(f)}}return e.onHover&&(f.on("mouseover",m=>{const g=m.sourceTarget;g.setStyle({color:e.hoverColor}),g.bringToFront(),e.onHover?.(g.messageEvent)}),f.on("mouseout",m=>{m.sourceTarget.setStyle(p),e.onHover?.(void 0)})),e.onClick&&f.on("click",m=>{const g=m.sourceTarget;g.messageEvent&&e.onClick?.(g.messageEvent)}),f}const ee=be;var O=r(68071),Pe=r(68773);function ue(e){const s=e.match(/\{.+?\}/g)??[],v=["{x}","{y}","{z}"];for(const n of s)if(!v.includes(n))return new Error(`Invalid placeholder ${n}`)}function Fe(e){switch(e){case"foxglove_msgs/GeoJSON":case"foxglove_msgs/msg/GeoJSON":case"foxglove::GeoJSON":case"foxglove.GeoJSON":return!0;default:return!1}}function Ge(e,s){const v=Pe.Z(s,(d,m)=>{const g=e.topicColors[m.name];d[m.name]={label:m.name,fields:{enabled:{label:"Enabled",input:"boolean",value:!e.disabledTopics.includes(m.name)},coloring:{label:"Coloring",input:"select",value:g?"Custom":"Automatic",options:[{label:"Automatic",value:"Automatic"},{label:"Custom",value:"Custom"}]},color:g?{label:"Color",input:"rgb",value:g}:void 0}}},{}),n=(0,ae.Z)(s,d=>e.disabledTopics.includes(d.name)||Fe(d.schemaName)?void 0:{label:d.name,value:d.name}),p=[{label:"Off",value:""},...n],f={layer:{label:"Tile layer",input:"select",value:e.layer,options:[{label:"Map",value:"map"},{label:"Satellite",value:"satellite"},{label:"Custom",value:"custom"}]}};if(e.layer==="custom"){let d;e.customTileUrl.length>0&&(d=ue(e.customTileUrl)?.message),f.customTileUrl={label:"Custom map tile URL",input:"string",value:e.customTileUrl,error:d},f.maxNativeZoom={label:"Max tile level",input:"select",value:e.maxNativeZoom,options:[18,19,20,21,22,23,24].map(m=>({label:String(m),value:m})),help:"Highest zoom supported by the custom map source. See https://leafletjs.com/examples/zoom-levels/ for more information."}}return f.followTopic={label:"Follow topic",input:"select",value:e.followTopic,options:p},{general:{label:"General",fields:f},topics:{label:"Topics",children:v}}}function Ue(e){switch(e.message.status?.status){case G.STATUS_GBAS_FIX:case G.STATUS_SBAS_FIX:case G.STATUS_FIX:return!0;case G.STATUS_NO_FIX:case void 0:default:return!1}}function oe(e){const s=e.schemaName;return s==="foxglove_msgs/GeoJSON"||s==="foxglove_msgs/msg/GeoJSON"||s==="foxglove::GeoJSON"||s==="foxglove.GeoJSON"}function me(e){if(oe(e))return!0;const s=e.message;return s.latitude!=null&&isFinite(s.latitude)&&s.longitude!=null&&isFinite(s.longitude)}function fe(e){switch(e){case"sensor_msgs/NavSatFix":case"sensor_msgs/msg/NavSatFix":case"ros.sensor_msgs.NavSatFix":case"foxglove_msgs/LocationFix":case"foxglove_msgs/msg/LocationFix":case"foxglove.LocationFix":case"foxglove::LocationFix":case"foxglove_msgs/GeoJSON":case"foxglove_msgs/msg/GeoJSON":case"foxglove::GeoJSON":case"foxglove.GeoJSON":return!0;default:return!1}}function Re(e){try{const s=JSON.parse(e);return(s?Array.isArray(s)?s:[s]:[]).flatMap(n=>{switch(n.type){case"Feature":{const p=n.properties?.style??{};return{object:n,style:p}}case"FeatureCollection":return(n.features??[]).map(p=>{const f=p.properties?.style??{};return{object:p,style:f}});default:return{object:n,style:{}}}})}catch(s){return console.error(s),[]}}const Ze=Oe()(e=>e.filter(me));function Be(e){const{context:s}=e,v=(0,i.useRef)(null),[n,p]=(0,i.useState)(()=>{const o=e.context.initialState;return{center:o.center,customTileUrl:o.customTileUrl??"",disabledTopics:o.disabledTopics??[],followTopic:o.followTopic??"",layer:o.layer??"map",topicColors:o.topicColors??{},zoomLevel:o.zoomLevel,maxNativeZoom:o.maxNativeZoom??18}}),[f]=(0,i.useState)(new h.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxNativeZoom:18,maxZoom:24})),[T]=(0,i.useState)(new h.TileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"&copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxNativeZoom:18,maxZoom:24})),[d]=(0,i.useState)(new h.TileLayer("https://example.com/{z}/{y}/{x}",{attribution:"",maxNativeZoom:18,maxZoom:24})),[m,g]=(0,i.useState)([]),[S,Y]=(0,i.useState)([]),[U,L]=(0,i.useMemo)(()=>Q.Z(m,oe),[m]),[B,b]=(0,i.useMemo)(()=>Q.Z(S,oe),[S]),[se,je]=(0,i.useState)([]),[K,We]=(0,i.useState)(),[l,Ye]=(0,i.useState)(void 0),{width:de,height:pe,ref:Ke}=(0,Le.NB)({refreshRate:0,refreshMode:"debounce"});(0,i.useEffect)(()=>{l?.invalidateSize()},[de,pe,l]);const[ge,Xe]=(0,i.useState)(()=>()=>{}),D=(0,i.useMemo)(()=>(0,ae.Z)(se,o=>{if(fe(o.schemaName))return o;if(o.convertibleTo){for(const t of o.convertibleTo)if(fe(t))return{name:o.name,schemaName:t}}}),[se]),ve=(0,i.useCallback)(o=>{if(o.action!=="update")return;const{path:t,input:c,value:u}=o.payload;if(t[0]==="topics"&&c==="boolean"){const a=t[1];a&&p((0,M.Uy)(E=>{E.disabledTopics=u===!0?ye.Z(E.disabledTopics,[a]):Te.Z(E.disabledTopics,[a])}))}if(t[0]==="topics"&&t[2]==="coloring"){const a=t[1];a&&p((0,M.Uy)(E=>{u==="Custom"?E.topicColors[a]=O.Hm[0]:delete E.topicColors[a]}))}if(t[0]==="topics"&&t[2]==="color"&&c==="rgb"&&u!=null){const a=t[1];a&&p((0,M.Uy)(E=>{E.topicColors[a]=u}))}t[1]==="layer"&&c==="select"&&p(a=>({...a,layer:String(u)})),t[1]==="customTileUrl"&&c==="string"&&p(a=>({...a,customTileUrl:String(u)})),t[1]==="maxNativeZoom"&&c==="select"&&p(a=>{const E=parseInt(String(u));return{...a,maxNativeZoom:isFinite(E)?E:a.maxNativeZoom}}),t[1]==="followTopic"&&c==="select"&&p(a=>({...a,followTopic:String(u)}))},[]);(0,i.useEffect)(()=>{n.layer==="map"?(l?.addLayer(f),l?.removeLayer(T),l?.removeLayer(d)):n.layer==="satellite"?(l?.addLayer(T),l?.removeLayer(f),l?.removeLayer(d)):n.layer==="custom"&&(l?.addLayer(d),l?.removeLayer(f),l?.removeLayer(T))},[n.layer,l,d,T,f]),(0,i.useEffect)(()=>{if(n.layer==="custom"){if(ue(n.customTileUrl))return;d.setUrl(n.customTileUrl)}},[n.layer,n.customTileUrl,d]),(0,i.useEffect)(()=>{n.layer==="custom"&&(d.options.maxNativeZoom=n.maxNativeZoom)},[n.layer,n.maxNativeZoom,d]),(0,i.useEffect)(()=>{const o=[];for(const c of D)n.disabledTopics.includes(c.name)||o.push({topic:c.name,convertTo:c.schemaName,preload:!0});s.subscribe(o);const t=Ge(n,D);return s.updatePanelSettingsEditor({actionHandler:ve,nodes:t}),()=>{s.unsubscribeAll()}},[n,s,D,ve]);const N=(0,i.useMemo)(()=>{const o=new Map;let t=0;for(const c of D){const u=new h.FeatureGroup,a=new h.FeatureGroup,E=new h.LayerGroup([u,a]);o.set(c.name,{topicGroup:E,allFrames:u,currentFrame:a,baseColor:n.topicColors[c.name]??O.Hm[t]}),t=(t+1)%O.Hm.length}return o},[n.topicColors,D]);(0,i.useLayoutEffect)(()=>{if(!l)return;const o=[...N.entries()];for(const[t,c]of o)n.disabledTopics.includes(t)||l.addLayer(c.topicGroup);return()=>{for(const[t,c]of o)l.removeLayer(c.topicGroup)}},[n.disabledTopics,l,N]),(0,i.useLayoutEffect)(()=>{if(!v.current)return;const o=new h.Map(v.current);return o.attributionControl.setPrefix(!1),o.setView(n.center?[n.center.lat,n.center.lon]:[0,0],n.zoomLevel??10),Ye(o),s.watch("topics"),s.watch("currentFrame"),s.watch("allFrames"),s.watch("previewTime"),s.onRender=(t,c)=>{Xe(()=>c),We(t.previewTime),t.topics&&je(u=>Ae.Z(u,t.topics)?u:t.topics??[]),t.allFrames&&g(Ze(t.allFrames)),t.currentFrame&&t.currentFrame.length>0&&Y(t.currentFrame.filter(me))},()=>{o.remove(),s.onRender=void 0}},[n.center,n.zoomLevel,s]);const V=(0,i.useCallback)(o=>{s.setPreviewTime(o==null?void 0:(0,_.toSec)(o.receiveTime))},[s]),X=(0,i.useCallback)(o=>{s.seekPlayback?.(o.receiveTime)},[s]),[R,we]=(0,i.useState)(n.center),[z,He]=(0,i.useState)(),Ee=(0,i.useCallback)((o,t,c)=>{const u=o.properties?.name;typeof u=="string"&&u.length>0&&c.bindTooltip(u),c.on("mouseover",()=>{V(t),c.openTooltip()}),c.on("mouseout",()=>{V(void 0),c.closeTooltip()}),c.on("click",()=>{X(t)})},[X,V]),w=(0,i.useCallback)((o,t)=>{const c=Re(o.message.geojson);for(const{object:u,style:a}of c)(0,h.geoJSON)(u,{onEachFeature:(E,ne)=>{Ee(E,o,ne)},style:n.topicColors[o.topic]?{color:n.topicColors[o.topic],...a}:a}).addTo(t)},[Ee,n.topicColors]);(0,i.useEffect)(()=>{we(o=>{if(!n.followTopic&&o)return o;for(const t of[b,L])for(const c of t)if(!(n.followTopic&&o&&c.topic!==n.followTopic))return{lat:c.message.latitude,lon:c.message.longitude};return o})},[L,b,n]),(0,i.useEffect)(()=>{if(l)for(const[o,t]of N){t.allFrames.clearLayers();const c=L.filter(a=>a.topic===o),u=ee({map:l,navSatMessageEvents:c,bounds:z??l.getBounds(),color:(0,O.UX)(t.baseColor),hoverColor:(0,O.eE)(t.baseColor),onHover:V,onClick:X});t.allFrames.addLayer(u),u.bringToBack(),U.filter(a=>a.topic===o).forEach(a=>{w(a,t.allFrames)})}},[w,U,L,l,z,X,V,N]),(0,i.useEffect)(()=>{if(!l)return;const o=re.Z(b,c=>c.topic);for(const[c,u]of Object.entries(o)){const a=N.get(c);if(!a)continue;a.currentFrame.clearLayers();const[E,ne]=Q.Z(u,Ue),Je=ee({map:l,navSatMessageEvents:ne,bounds:z??l.getBounds(),color:(0,O.eE)(a.baseColor),hoverColor:(0,O.eE)(a.baseColor),showAccuracy:!0}),ke=ee({map:l,navSatMessageEvents:E,bounds:z??l.getBounds(),color:a.baseColor,hoverColor:(0,O.eE)(a.baseColor),showAccuracy:!0});a.currentFrame.addLayer(Je),a.currentFrame.addLayer(ke)}const t=re.Z(B,c=>c.topic);for(const[c,u]of Object.entries(t)){const a=N.get(c);if(a){a.currentFrame.clearLayers();for(const E of u)w(E,a.currentFrame)}}},[w,B,l,b,z,N]),(0,i.useEffect)(()=>{if(!l||K==null)return;const o=L.filter(a=>(0,_.toSec)(a.receiveTime)<=K),t=Se.Z(o,a=>K-(0,_.toSec)(a.receiveTime));if(!t)return;const c=N.get(t.topic),u=new h.CircleMarker([t.message.latitude,t.message.longitude],{radius:ce,color:c?(0,O.eE)(c.baseColor):void 0,stroke:!1,fillOpacity:1,interactive:!1});return u.addTo(l),()=>{u.remove()}},[L,l,K,N]),(0,i.useEffect)(()=>{if(!l)return;const o=()=>{s.saveState({center:{lat:l.getCenter().lat,lon:l.getCenter().lng}})},t=()=>{s.saveState({zoomLevel:l.getZoom()})};return l.on("move",o),l.on("zoom",t),()=>{l.off("move",o),l.off("zoom",t)}},[s,l]),(0,i.useEffect)(()=>{s.saveState(n)},[s,n]);const he=(0,Ne.y1)(o=>{He(o.getBounds())},100,{leading:!1,maxWait:100});(0,i.useEffect)(()=>{if(!l)return;const o=()=>he(l);return l.on("move",o),()=>{l.off("move",o)}},[l,he]);const Ce=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(!R)return;const o=Ce.current?l?.getZoom():n.zoomLevel??10;l?.setView([R.lat,R.lon],o),Ce.current=!0},[R,n.zoomLevel,l]),(0,i.useEffect)(()=>{ge()},[ge]),(0,C.jsxs)(q.Z,{ref:Ke,fullHeight:!0,fullWidth:!0,position:"relative",children:[!R&&(0,C.jsx)(q.Z,{alignItems:"center",justifyContent:"center",position:"absolute",style:{top:0,right:0,bottom:0,left:0},children:"Waiting for first GPS point..."}),(0,C.jsx)(q.Z,{position:"absolute",ref:v,style:{inset:0,cursor:"auto",visibility:R?"visible":"hidden"}})]})}const De=Be;var Qe=r(92037);Z().Marker.prototype.options.icon=Z().icon({iconUrl:k,iconRetinaUrl:J,shadowUrl:$,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});function Ve(e,s){return j.render((0,C.jsx)(i.StrictMode,{children:(0,C.jsx)(y.o,{onError:e,children:(0,C.jsx)(De,{context:s})})}),s.panelElement),()=>{j.unmountComponentAtNode(s.panelElement)}}function te(e){const s=(0,x.iY)(),v=(0,i.useMemo)(()=>Ve.bind(void 0,s),[s]);return(0,C.jsx)(A._,{config:e.config,saveConfig:e.saveConfig,initPanel:v,highestSupportedConfigVersion:1})}te.panelType="map",te.defaultConfig={};const ze=(0,P.Z)(te)},68071:(H,I,r)=>{r.d(I,{A2:()=>J,Hm:()=>h,UX:()=>k,eE:()=>$,wi:()=>j});var C=r(4e4),i=r(63852),x=r(77068),P=r(1547),A=r(25302);const h=[A.Y.blue.medium,A.Y.orange.medium,A.Y.yellow.medium,A.Y.green.medium,A.Y.cyan.medium,A.Y.purple.medium,A.Y.paleGreen.medium],Z=h.map(y=>[y,...(0,P.Z)(y).tetrad().map(M=>M.toHexString())]),J=C.Z(i.Z(0,Z[0].length).map(y=>Z.map(M=>M[y])).flat()),k=x.Z(y=>(0,P.Z)(y).brighten(15).toString()),$=x.Z(y=>(0,P.Z)(y).darken(30).toString());function j(y,M){return y??h[M%h.length]}},25302:(H,I,r)=>{r.d(I,{B:()=>x,Y:()=>i});var C=r(1547);const i={base:{dark:"#1F1E27",medium:"#8B8B8D",light:"#F7F7F3"},red:{dark:"#F24366",medium:"#ff7c96",light:"#FFAABB"},blue:{dark:"#1b83ec",medium:"#4e98e2",light:"#77AADD"},paleGreen:{dark:"#B4CC00",medium:"#cad660",light:"#CDD67E"},orange:{dark:"#ea531f",medium:"#f5774d",light:"#faa487"},cyan:{dark:"#22b5ff",medium:"#61cbff",light:"#99DDFF"},green:{dark:"#05d27d",medium:"#5cd6a9",light:"#8de0c9"},purple:{dark:"#6E51EE",medium:"#a395e2",light:"#c7c0e7"},yellow:{dark:"#EDCC28",medium:"#f7df71",light:"#f1e4aa"}},x=(0,C.Z)("hsv(0, 0%, 75%)").toHexString()}}]);

//# sourceMappingURL=6503.7bfda7480d26b6fd8f31.js.map