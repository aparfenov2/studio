"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1815],{11815:(ee,N,a)=>{a.r(N),a.d(N,{default:()=>q});var r=a(52322),x=a(1309),Z=a(68234),M=a(68434),A=a(20379),E=a(38677),f=a(2784),O=a(72970),V=a(94225),B=a(75785),J=a(75017),$=a(76479),h=a(93812),H=a(5227),I=a(91004),y=a(85026),C=a(24304);function L({topic:t,schemaName:n,datatypes:e,name:s}){const[i]=(0,f.useState)(()=>(0,I.Z)()),o=(0,y.An)(l=>l.playerState.capabilities.includes(C.C.advertise)),u=(0,y.An)(l=>l.publish),m=(0,y.An)(l=>l.setPublishers);return(0,f.useEffect)(()=>{if(o&&t&&n)return m(i,[{topic:t,schemaName:n,options:{datatypes:e}}]),()=>{m(i,[])}},[i,t,n,e,s,m,o]),(0,f.useCallback)(l=>{o&&u({topic:t,msg:l})},[u,t,o])}var P=a(39367),W=a(77075),z=a(67067),T=a(65741),F=a(25513);const G={bool:!1,int8:0,uint8:0,int16:0,uint16:0,int32:0,uint32:0,int64:0,uint64:0,float32:0,float64:0,string:"",time:{sec:0,nsec:0},duration:{sec:0,nsec:0}};function j(t,n){const e=G[n];if(e!=null)return e;const s=t.get(n)?.definitions;if(!s)return;const i={};for(const o of s){if(o.isConstant??!1)continue;const u=j(t,o.type);o.isArray??!1?o.arrayLength!=null?i[o.name]=new Array(o.arrayLength).fill(u):i[o.name]=[u]:i[o.name]=u}return i}const R={buttonText:"Publish",buttonTooltip:"",advancedView:!0,value:"{}"};function U(t,n){if(!n)return"Message schema cannot be empty";if(!t.includes(n))return"Schema name not found"}function D(t){if(!t)return"Topic cannot be empty"}const K=(t,n,e)=>({general:{fields:{topicName:{label:"Topic",input:"autocomplete",error:D(t.topicName),value:t.topicName??"",items:e.map(s=>s.name)},datatype:{label:"Message schema",input:"autocomplete",error:U(n,t.datatype),items:n,value:t.datatype??""},advancedView:{label:"Editing mode",input:"boolean",value:t.advancedView}}},button:{label:"Button",fields:{buttonText:{label:"Title",input:"string",value:t.buttonText},buttonTooltip:{label:"Tooltip",input:"string",value:t.buttonTooltip},buttonColor:{label:"Color",input:"rgb",value:t.buttonColor}}}}),S=(t,n)=>{if(n==null)return;const e=j(t,n);return e!=null?JSON.stringify(e,void 0,2):"{}"};function Q(t,n,e,s){const i=(0,P.W0)(),o=(0,f.useMemo)(()=>Array.from(s.keys()).sort(),[s]),u=(0,f.useCallback)(m=>{if(m.action!=="update")return;const{path:l,value:d,input:v}=m.payload;n((0,z.Uy)(p=>{if(v==="autocomplete"){if(T.Z(l,["general","topicName"])){const c=e.find(b=>b.name===d)?.schemaName,g=S(s,c);p.topicName=d,c&&(p.datatype=c),g&&(p.value=g)}else if(T.Z(l,["general","datatype"])){const c=S(s,d);p.datatype=d,c&&(p.value=c)}}else F.Z(p,l.slice(1),d)}))},[s,n,e]);(0,f.useEffect)(()=>{i({actionHandler:u,nodes:K(t,o,e)})},[u,t,o,e,i])}var X=a(2784);const Y=(0,O.ZL)()((t,{buttonColor:n})=>{const e=n?t.palette.augmentColor({color:{main:n}}):void 0;return{button:{backgroundColor:e?.main,color:e?.contrastText,"&:hover":{backgroundColor:e?.dark}},textarea:{height:"100%",[`.${x.Z.root}`]:{width:"100%",height:"100%",textAlign:"left",backgroundColor:t.palette.background.paper,overflow:"hidden",padding:t.spacing(1,.5),[`.${x.Z.input}`]:{height:"100% !important",lineHeight:1.4,fontFamily:W.R.MONOSPACE,overflow:"auto !important",resize:"none"}}}}});function w(t){let n,e;try{const s=JSON.parse(t);Array.isArray(s)?e="Message content must be an object, not an array":s==null?e="Message content must be an object, not null":typeof s!="object"?e=`Message content must be an object, not \u2018${typeof s}\u2019`:n=s}catch(s){e=t.length!==0?s.message:"Enter valid message content as JSON"}return{error:e,parsedObject:n}}function k(t){const{saveConfig:n,config:e}=t,{topics:s,datatypes:i,capabilities:o}=(0,B.Ui)(),{classes:u}=Y({buttonColor:e.buttonColor}),[m]=(0,V.Nr)(e.topicName??"",500),l=L({name:"Publish",topic:m,schemaName:e.datatype,datatypes:i}),{error:d,parsedObject:v}=(0,f.useMemo)(()=>w(e.value??""),[e.value]);Q(e,n,s,i);const p=(0,H.Z)(()=>{if(e.topicName!=null&&v!=null)l(v);else throw new Error("called _publish() when input was invalid")},[e.topicName,v,l]),[,c]=(0,P._N)();(0,f.useEffect)(()=>{e.topicName!=null&&e.topicName.length>0?c(`Publish ${e.topicName}`):c("Publish")},[e.topicName,c]);const g=Boolean(o.includes(C.C.advertise)&&e.value&&e.topicName&&e.datatype&&v!=null),b=(0,f.useMemo)(()=>{if(!o.includes(C.C.advertise))return"Connect to a data source that supports publishing";if(!e.topicName||!e.datatype)return"Configure a topic and message schema in the panel settings"},[o,e.datatype,e.topicName]);return(0,r.jsxs)(h.Z,{fullHeight:!0,children:[(0,r.jsx)($.Z,{}),(0,r.jsxs)(h.Z,{flex:"auto",gap:1,padding:1.5,position:"relative",children:[e.advancedView&&(0,r.jsx)(h.Z,{flexGrow:"1",children:(0,r.jsx)(Z.Z,{variant:"outlined",className:u.textarea,multiline:!0,size:"small",placeholder:"Enter message content as JSON",value:e.value,onChange:_=>{n({value:_.target.value})},error:d!=null})}),(0,r.jsxs)(h.Z,{direction:e.advancedView?"row":"column-reverse",justifyContent:e.advancedView?"flex-end":"center",alignItems:"center",overflow:"hidden",flexGrow:0,gap:1.5,children:[(d!=null||b!=null)&&(0,r.jsx)(M.Z,{variant:"caption",noWrap:!0,color:d?"error":void 0,children:d??b}),(0,r.jsx)(A.Z,{placement:e.advancedView?"left":void 0,title:e.buttonTooltip,children:(0,r.jsx)("span",{children:(0,r.jsx)(E.Z,{className:u.button,variant:"contained",disabled:!g,onClick:p,children:e.buttonText})})})]})]})]})}const q=(0,J.Z)(Object.assign(X.memo(k),{panelType:"Publish",defaultConfig:R}))}}]);

//# sourceMappingURL=1815.428a2daae28a76581824.js.map